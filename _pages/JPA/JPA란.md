---
title : "1. JPA 소개"
tags : 
    - JPA
date : "2024-07-22"
thumbnail : "/assets/img/thumbnail/springDataJPA.jpg"
bookmark : true
---

# JPA 소개

### SQL을 직접 사용할 때의 문제점
- 계층 분할이 어렵다. 
- 엔티티를 신뢰할 수 없다. 
- SQL 의존적인 개발을 하게 된다. 

### 패러다임의 불일치

객체와 관계형 데이터베이스의 차이는
1. 상속
2. 연관 관계
3. 객체 그래프 탐색
4. 비교

<br>가 있다. 

#### 상속

객체는 명확한 상속 관계가 존재한다. <br>
RDB에는 슈퍼타입-서브타입 관계가 존재한다.
![JPA1](/assets/img/jpa/1.png "jpa1")

Album 객체를 저장하기 위해서는 Album 객체를 Album과 Item으로 분해한 후 각각 Insert를 해주어야하고,<br>
조회하기 위해서는 Item과 Album을 조인한 후 각각의 객체를 생성해야 한다. 
<br>
JPA는 하위 타입을 저장할 때 상위, 하위 타입에 해당하는 INSERT를 실행해 두 테이블에 나누어 저장한다. 조회시에는 필요한 테이블을 조인하여 데이터를 반환한다. 

#### 연관관계

객체는 참조를 이용하고, 테이블은 외래키를 이용한다. 
![JPA](/assets/img/jpa/2.png "jpa")

1. 객체 모델링을 테이블 중심으로 하는 경우
테이블에 저장하거나 조회할 때 객체 필드를 사용하기 때문에 편하지만, 객체 그래프 탐색이 불가능하다. 
2. 객체 모델링을 객체 지향적으로 하는 경우
객체는 참조를 통해서 관계를 맺는다. 객체 참조가 있기 때문에 탐색이 가능하지만, 객체를 저장하기 위해 SQL 변환 작업이 필요하다. 
<br>
JPA는 관계를 맺고 있는 객체 참조를 외래키로 변환하여 INSERT sql문을 작성하고, 조회시에는 외래키를 참조하는 변환을 처리해준다. 

#### 객체 그래프 탐색

![JPA](/assets/img/jpa/3.png "jpa")
SQL을 직접 다루면 처음 실행하는 SQL에 따라 객체 그래프를 어디까지 탐색할 수 있는지 정해진다. <br>
하지만 연관된 모든 객체 그래프를 조회해 메모리에 올려두는 것은 현실성이 없음. 
<br>
JPA는 실제 객체를 사용하는 시점가지 데이터베이스 조회를 미루는 지연 로딩을 사용한다. 

#### 비교

데이터베이스는 기본 키의 값으로 각 row를 구분하고, 객체는 동일성 비교과 동등성 비교 두 가지가 있다. 
- 동일성 비교
    Identity, "=="을 이용한 비교, 객체 인스턴스의 주소 값을 비교한다. 실제 인스턴스가 같다. 
- 동등성 비교
    Equality, "equals()" 메소드를 이용한 비교, 객체의 내부 값을 비교한다. 실제 인스턴스는 다를 수 있으나, 갖고 있는 값이 같다. 

<br>JPA는 같은 트랜잭션 일 때 같은 객체가 조회되는 것을 보장한다. 

```
객체 모델과 관계형 데이터베이스 모델은 지향하는 패러다임이 다르다. 
한쪽으로 치우친 개발은 처리할 문제가 많아지게 함.
JPA를 사용하면 패러다임 불일치 문제를 해결해준다. 
```

# JPA를 사용하는 이유

### JPA란

- Java Persistance API
- 자바의 ORM 기술 표준 명세이다. 

```
ORM(Object-Relation Mapping; 객체 관계 매핑)
객체로 연결해준다는 의미로, 어플리케이션과 데이터베이스 연결시
SQL언어가 아닌 어플리케이션 개발 언어로 데이터베이스에 접근할 수 있게 해주는
프레임 워크이다. 

ORM을 사용하면 sql문법 대신 어플리케이션의 개발 언어를 그대로 사용할 수 있어
개발 언어의 일관성과 가독성을 제공한다. 

객체는 객체대로 설계하고, 관계형 데이터베이스는 관계형 데이터베이스대로
설계를 하면 중간에서 매핑해준다. 
```

### 동작 방식

JPA는 Java 애플리케이션과 JDBC 사이에서 동작한다. 
![JPA](/assets/img/jpa/4.png "jpa")

1. Java 애플리케이션이 JPA api 호출
2. JPA는 JDBC api 호출
3. JDBC는 sql을 생성 및 실행
4. DB에서 결과를 받음. 

#### 저장 방식
![JPA](/assets/img/jpa/5.png "jpa")

#### 조회 방식
![JPA](/assets/img/jpa/6.png "jpa")

> JPA의 가장 큰 역할은 패러다임 불일치 해결이다. 

### 구현체 종류

![JPA](/assets/img/jpa/7.png "jpa")
JPA는 자바 ORM 기술에 대한 표준 API 표준 명세이다. JPA를 사용하기 위한 다양한 구현체가 있다. <br>
하이버네이트(Hibernate)가 가장 많이 사용된다. 

### JPA를 사용하는 이유

1. 생산성 / 유지보수
    객체에 맞는 SQL(DDL, CRUD)를 생성해 준다. 

2. 패러다임 불일치 해결
    상속, 연관관계, 객체 그래프 탐색, 비교 등 패러다임의 불일치를 해결해준다. 

3. 성능
    애플리케이션과 데이터베이스 사이에 계층을 두어 버퍼링과 캐시 기능을 지원한다. 

4. 데이터 접근 추상화와 벤더 독립성
    애플리케이션과 데이터베이스 사이에 추상화된 데이터 접근 계층을 제공해, 특정 DB 기술에 종속되지 않도록 도와준다. 

5. 표준
    특정 구현체에 종속되지 않도록 한다. 